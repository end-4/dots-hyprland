"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[3509],{59282:(e,t,l)=>{l.d(t,{R:()=>n});var s=l(30758),a=l(75866);const n=()=>{const[e,t]=(0,s.useState)(!1),l=(0,a.K)(a.X.CollaborativePlaylists);return(0,s.useEffect)((()=>{l&&t(!0)}),[l,t]),{toggleActivationVisible:e,setToggleActivationVisible:t}}},32583:(e,t,l)=>{l.d(t,{u:()=>ee,Y:()=>te});var s=l(30758),a=l(97500),n=l.n(a),i=l(62411),o=l(61e3),r=l(21466),u=l(93492),c=l(585),f=l(92197),d=l(13505),h=l(50048),b=l(74008),m=l(55669),S=l(56695),g=l(50107),y=l(89366),v=l(25954);const p="zNnlcxsmnV1RiWXSd4IA",F="a3sk2brhAAMoZderfRfg";var R=l(86070);const j=({icon:e,name:t,isActive:l,onClick:s,isDsaRestricted:a})=>{const n=l?"textBrightAccent":void 0;return(0,R.jsx)(S.D,{role:"menuitemradio",leadingIcon:(0,R.jsx)(e,{iconSize:16,semanticColor:n}),onClick:s,"aria-checked":l,disabled:a,children:(0,R.jsx)(d.E,{variant:"bodySmall",semanticColor:n,children:t})})},A=({shuffleMode:e,onClick:t,spec:l,logger:a,isDsaRestricted:n})=>{const r=(0,i.wA)(),c=(0,s.useCallback)((()=>{r(g.cI.actions.open())}),[r]),f=(0,s.useCallback)((()=>{t(v.j.ON,(e=>{l&&(e?a.logInteraction(l?.toggleShuffleButtonFactory().hitShuffleDisable()):a.logInteraction(l?.toggleShuffleButtonFactory().hitShuffleEnable()))}))}),[a,t,l]),S=(0,s.useCallback)((()=>{const e=e=>{l&&(e?a.logInteraction(l?.toggleSmartShuffleButtonFactory().hitSelectShuffleMode({previousMode:"smart_shuffle",selectedMode:"linear"})):a.logInteraction(l?.toggleSmartShuffleButtonFactory().hitSelectShuffleMode({previousMode:"linear",selectedMode:"smart_shuffle"})))};n||t(v.j.SMART_SHUFFLE,e)}),[n,a,t,l]),A=n?u.Ru.get("web-player.smart-shuffle.dsa-message"):u.Ru.get("web-player.smart-shuffle.menu-text");return(0,R.jsxs)(m.W,{getInitialFocusElement:e=>e?.querySelector('[aria-checked="true"]'),children:[(0,R.jsx)(j,{icon:h.p,name:u.Ru.get("web-player.smart-shuffle.shuffle"),isActive:e===v.j.ON,onClick:f}),(0,R.jsx)(j,{icon:b.k,name:u.Ru.get("web-player.smart-shuffle.smart-shuffle"),isActive:e===v.j.SMART_SHUFFLE,onClick:S,isDsaRestricted:n}),(0,R.jsx)(d.E,{className:p,variant:"bodySmall",semanticColor:"textSubdued",as:"p",children:A}),!n&&(0,R.jsx)(y.u,{children:(0,R.jsx)(o.H,{role:"menuitem",className:F,semanticColor:"textSubdued",onClick:c,size:"small",children:u.Ru.get("web-player.smart-shuffle.menu-button")})})]})},E={[v.j.OFF]:{icon:h.p,label:e=>e?u.Ru.get("web-player.smart-shuffle.button-disable-shuffle-specific",e):u.Ru.get("web-player.smart-shuffle.button-disable-shuffle-generic")},[v.j.ON]:{icon:h.p,semanticColor:"textBrightAccent",label:e=>e?u.Ru.get("web-player.smart-shuffle.button-enable-shuffle-specific",e):u.Ru.get("web-player.smart-shuffle.button-enable-shuffle-generic")},[v.j.SMART_SHUFFLE]:{icon:b.k,semanticColor:"textBrightAccent",label:e=>e?u.Ru.get("web-player.smart-shuffle.button-enable-smart-shuffle-specific",e):u.Ru.get("web-player.smart-shuffle.button-enable-smart-shuffle-generic")}};var M=l(54981),w=l(48383),x=l(36923),C=l(48717);const D={bottomEnd:x.dw.topStart,top:x.dw.bottom},k=({placement:e,onHide:t,label:l})=>((0,C.g)(t),(0,R.jsx)("div",{children:(0,R.jsx)(M.A,{arrow:D[e],colorSet:"announcement",onClose:t,children:l})})),O=e=>{const{placement:t,visible:l,children:s}=e;return(0,R.jsx)(w.W,{placement:t,withPortal:!0,overlay:l&&(0,R.jsx)(k,{...e}),children:s})};var L=l(46710),T=l(48975),B=l(8008),H=l(18308);function I(){return(0,H.N)(B.X)}var N=l(8903),U=l(98929),_=l(64669),P=l(34668),q=l(99794),z=l(22408),V=l(40638);const K=e=>["use-shuffle",e,"shuffle-mode"];const X=e=>{const t=(e=>{const t=I(),l=!(0,T.n)();let s=(0,L.I)({queryKey:["use-shuffle",e,"can-smart-shuffle"],queryFn:()=>t.getAvailableShuffleModes(e),staleTime:36e5,gcTime:72e5}).data;return l&&(s=[v.j.OFF,v.j.ON]),s})(e),[l,a]=function(e){const t=I(),l=(0,U.jE)(),a=(0,s.useRef)(null),{isActive:n}=(0,z.l_)(e),i=(0,P.o)(q.l),[o]=(0,V.d7)(i,1e3),r=(0,L.I)({queryKey:K(e),queryFn:async()=>await t.getShuffle(e),staleTime:0,gcTime:72e5}).data;(0,s.useEffect)((()=>{l.invalidateQueries({queryKey:K(e)})}),[e,o,l]);const u=(0,s.useCallback)((s=>{const n=K(e);if(a.current&&clearTimeout(a.current),s!==v.j.SMART_SHUFFLE)return t.setShuffle(e,s);l.setQueryData(n,v.j.SMART_SHUFFLE),a.current=setTimeout((()=>t.setShuffle(e,s)),1e3)}),[e,l,t]);return(0,s.useEffect)((()=>{const s=t.getEvents(),a=K(e),i=s.addListener(_.S.UPDATE,(({data:t})=>{t.contextURI===e&&l.setQueryData(a,t.shuffleMode)})),o=s.addListener(_.S.UPDATE_COMPLETE,(({data:t})=>{t.contextURI!==e||n||l.invalidateQueries({queryKey:a})})),r=s.addListener(_.S.UPDATE_ERROR,(()=>{l.invalidateQueries({queryKey:a})}));return()=>{i(),o(),r()}}),[e,n,o,l,t]),[r??v.j.OFF,u]}(e),n=(0,N.p)(),i=(0,s.useMemo)((()=>{if(!t)return;const e=void 0!==l?t.indexOf(l):-1;let s=t[(e+1)%t.length];return n||s!==v.j.SMART_SHUFFLE||(s=t[(e+2)%t.length]),s}),[l,t,n]),o=(0,s.useCallback)((()=>{if(void 0!==i)return a(i),i}),[i,a]);return{shuffleMode:l,nextShuffleMode:i,availableShuffleModes:t,setShuffleMode:a,cycleShuffleMode:o,isDsaRestricted:!n}};var Q=l(43995),Z=l(71338),W=l(72288),G=l(99802),Y=l(82362);const J="E1ikFpkPVaoLplbQdrTP",$="nozebc1PGSbzmePU25qY",ee=({label:e,shuffleModeConfig:t,size:l="large",onClick:a,disabled:i=!1,activationVisible:r=!1,shuffleIsOn:u,focusOnRender:c=!1,offsetDotDistance:d=!0,withPadding:h=!1,className:b,showDelayOnHover:m})=>{const S=(0,s.useRef)(null);return(0,s.useEffect)((()=>{c&&S.current?.focus()}),[c]),(0,R.jsx)(f.Zp,{label:e,showDelay:m,children:(0,R.jsx)(o.H,{onClick:i?void 0:a,iconOnly:t.icon,semanticColor:t.semanticColor,size:l,"aria-describedby":r?"smartShuffleActivationDescription":void 0,"aria-label":e,"aria-disabled":i,condensedAll:!h,className:n()({[J]:u,[$]:d},b),ref:S})})},te=({entityName:e,contextUri:t,activationPlacement:l,size:a,isActive:n=!1,offsetDotDistance:o=!0,withPadding:f=!1,disabled:d=!1,shuffleContext:h,withActivation:b=!0,withSnackbar:m=!0,className:S,showDelayOnHover:g})=>{const{shuffleMode:y,nextShuffleMode:p,availableShuffleModes:F,setShuffleMode:j,cycleShuffleMode:M,isDsaRestricted:w}=X(t),{spec:x}=(0,Y.r)(r.a,{data:{uri:t}}),C=(0,s.useMemo)((()=>x.menuShuffleButtonFactory()),[x]),D=(0,G.s)(),{enqueueSnackbar:k}=(0,Z.d)(),[L,T]=(0,s.useState)(!1),{isOpen:B}=(0,i.d4)((e=>e.ui.introducingSmartShuffleModal)),H=E[y],I=void 0!==p?E[p]:void 0,U=F?.includes(v.j.SMART_SHUFFLE),[_,P,q,z]=(0,Q.Z)(F,h,b,y),V=(0,s.useCallback)((e=>{e===v.j.SMART_SHUFFLE?k(n?u.Ru.get("web-player.smart-shuffle.enabled-smart-shuffle"):u.Ru.get("web-player.smart-shuffle.enabled-smart-shuffle-not-active-playlist")):y===v.j.SMART_SHUFFLE&&k(u.Ru.get("web-player.smart-shuffle.disabled-smart-shuffle"))}),[y,k,n]),K=()=>{z(!1),P(!1)},J=(0,s.useCallback)((e=>e===v.j.SMART_SHUFFLE?"smart_shuffle":e===v.j.ON?"shuffle":"linear"),[]),[$,te]=(0,W.x)("smart-shuffle-menu",0),le=(0,N.p)(),se=$>=3||!U,ae={label:I?.label?.(e,!!U&&le)??u.Ru.get("web-player.smart-shuffle.smart-shuffle"),shuffleModeConfig:H,size:a,activationVisible:_,shuffleIsOn:y!==v.j.OFF,offsetDotDistance:o,withPadding:f,disabled:d,className:S};return se?(0,R.jsx)(O,{visible:q,onHide:K,placement:l,label:u.Ru.get("web-player.smart-shuffle.activation-text"),children:(0,R.jsx)(ee,{...ae,onClick:()=>{const e=y,t=M();K(),m&&V(t),U?D.logInteraction(x.regularShuffleButtonFactory().hitSelectShuffleMode({previousMode:J(e),selectedMode:J(t)})):D.logInteraction(t===v.j.ON?x.regularShuffleButtonFactory().hitShuffleEnable():x.regularShuffleButtonFactory().hitShuffleDisable())},focusOnRender:L,showDelayOnHover:g})}):(0,R.jsx)(O,{visible:_,onHide:K,placement:l,label:u.Ru.get("web-player.smart-shuffle.activation-message"),children:(0,R.jsx)(c.b,{menu:(0,R.jsx)(A,{shuffleMode:y,onClick:(e,t)=>{const l=e===y?v.j.OFF:e;j(l),V(l),t(l===v.j.OFF)},spec:C,logger:D,isDsaRestricted:w}),onHide:()=>{$+1===3&&(T(!0),D.logImpression(x.tristateOnboardingTooltipFactory().impression())),te($+1)},onShow:()=>{K(),D.logInteraction(x.menuShuffleButtonFactory().hitUiReveal())},onClickOutside:e=>{B||e()},children:(e,t)=>(0,R.jsx)(ee,{...ae,onClick:e=>{t(e)},showDelayOnHover:g})})})}},75866:(e,t,l)=>{l.d(t,{X:()=>n.X,K:()=>a});var s=l(85387);function a(e){const{search:t}=(0,s.zy)();return new URLSearchParams(t).get("feature-activation")===e}var n=l(66992)},66992:(e,t,l)=>{l.d(t,{X:()=>s});let s=function(e){return e.SmartShuffle="smart-shuffle",e.GroupSessions="group-sessions",e.Blend="blend",e.CollaborativePlaylists="collaborative-playlists",e.Dj="dj",e.VeryHighQualityAudio="very-high-quality-audio",e.LiveEvents="live-events",e}({})},43995:(e,t,l)=>{l.d(t,{b:()=>r,Z:()=>u});var s=l(30758),a=l(75866),n=l(59282),i=l(40849),o=l(25954);const r={playlistActionBar:"playlist-action-bar"},u=(e,t,l,u)=>{const{seen:c,setSeen:f}=(0,i.i)(),[d,h]=(0,s.useState)(!c),[b,m]=(0,s.useState)(!1),{toggleActivationVisible:S}=(0,n.R)(),g=(0,a.K)(a.X.SmartShuffle),y=d&&!!e?.includes(o.j.SMART_SHUFFLE)&&!S&&l;return(0,s.useLayoutEffect)((()=>{y&&f(!0),g&&t===r.playlistActionBar&&u===o.j.OFF&&m(!0)}),[y,f,g,t,m,u]),[y,h,b,m]}},38803:(e,t,l)=>{l.d(t,{X:()=>i});var s=l(3118),a=l(64640);let n=function(e){return e[e.DISABLED=0]="DISABLED",e[e.ENABLED=1]="ENABLED",e}({});const i=(e=!1)=>((e=!1)=>(0,s.NC)(a.uy,e?void 0:{loadingValue:!1})?n.ENABLED:n.DISABLED)(e)===n.ENABLED},40849:(e,t,l)=>{l.d(t,{i:()=>a});var s=l(72288);const a=()=>{const[e,t]=(0,s.x)("smart-shuffle-seen",!1);return{seen:e,setSeen:t}}}}]);
//# sourceMappingURL=3509.js.map