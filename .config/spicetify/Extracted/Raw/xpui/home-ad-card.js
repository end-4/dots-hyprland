"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[599,1408],{29028:(e,t,s)=>{s.d(t,{U:()=>n});var a=s(93492),i=s(79202),o=s(585),r=s(86070);const n=({menu:e,onClick:t,"aria-label":s})=>(0,r.jsx)(o.b,{menu:e,children:(0,r.jsx)(i.e,{size:i.M.xs,label:a.Ru.get("more"),ariaLabel:s,onClick:t})})},9551:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ze});var a=s(30758),i=s(70585);const o={opacity:0,height:"0px"};function r({dismiss:e}){const[t,s]=(0,a.useState)(null),[r,n]=(0,a.useState)(0);(0,a.useEffect)((()=>{if(t){n(t.offsetHeight);const e=new ResizeObserver((()=>n(t.offsetHeight)));return e.observe(t),()=>e.disconnect()}return n(0),()=>{}}),[t]);const l=r?(e=>({opacity:1,height:`calc(${e}px + ${(0,i.po)("base")})`}))(r):o,d=(0,a.useRef)(null);return{setGridElement:s,shownHeight:r,transitionableStyles:l,containerRef:d,collapseHeightThenDismiss(){if(!d.current||!r)return void e();d.current.animate([l,o],{fill:"forwards",easing:"ease",duration:420}).onfinish=e}}}var n=s(97500),l=s.n(n),d=s(77298),c=s(54683),u=s(93492),m=s(29028),h=s(10252),y=s(9159),v=s(92448),b=s(40565),f=s(55669),g=s(56695),x=s(24395),p=s(86070);const j=(0,a.memo)((function({onDismissAdClick:e}){return(0,p.jsx)(x.pZ,{value:"home-ad",children:(0,p.jsx)(f.W,{children:(0,p.jsx)(x.pZ,{value:"dismiss",children:(0,p.jsx)(g.D,{role:"menuitem",leadingIcon:(0,p.jsx)(b.P,{size:"small"}),"aria-label":u.Ru.get("ad-formats.context-menu.not-interested"),onClick:e,children:u.Ru.get("ad-formats.context-menu.not-interested")})})})})}));var k=s(26906),P=s(49559);const C="kvXKrQ08Ar7oAsMVJNOg",A="dBm03FPk9rHjecHq1Qnn",E=({className:e,homeAd:t,dismiss:s})=>{const a=(0,k.vh)(),i=(0,v.L)(),o=l()(C,e),{extractedHomeAdColor:[r]}=(0,y.bT)(),n=(0,P.J)((()=>{s(),i.log("collapsed",t),a.send((0,c.F)({ad_id:t.adId,advertiser:t.metadata.advertiser,creative_id:t.metadata.creative_id,event:"dislike_HPTO",format:(0,d.gh)(t.format),line_item_id:t.metadata.line_item_id}))})),b=(0,P.J)((()=>{i.log("clicked",t)})),f=t.metadata.buttonText||u.Ru.get("ad-formats.learnMore");return(0,p.jsxs)("div",{className:o,children:[t.clickthroughUrl&&(0,p.jsx)(h.CtaButton,{className:A,"aria-label":`${f}, link`,text:f,clickUrl:t.clickthroughUrl,onClick:b,backgroundColor:r?.colorDark}),(0,p.jsx)(m.U,{"aria-label":"More options, button",menu:(0,p.jsx)(j,{onDismissAdClick:n})})]})};var N=s(13505),w=s(5119);const _="lscHwwYXzt0CrEPAQgu3",R=({className:e,description:t,label:s,homeAd:a})=>{const i=l()(_,e),{clickthroughUrl:o,metadata:{tagline:r}}=a,n=(0,v.L)(),d=(0,P.J)((()=>{o&&n.log("clicked",a)}));return(0,p.jsxs)("div",{className:i,children:[s&&(0,p.jsx)(N.E,{variant:"bodyMedium",children:s}),r&&(0,p.jsx)(w.N,{to:o,onClick:d,"aria-label":`${r}, link`,children:(0,p.jsx)(N.E,{variant:"titleMedium",children:r})}),t&&(0,p.jsx)(N.E,{variant:"bodySmall",children:t})]})};var S=s(12431),T=s(94154),U=s(55158);const V="rLoSLtWsmOdhdiNz3r17",M=({className:e,homeAd:t})=>{const{metadata:{advertiser:s,logoImage:a},clickthroughUrl:i}=t,o=(0,v.L)(),r=(0,P.J)((()=>{i&&o.log("clicked",t)}));return(0,p.jsx)(w.N,{"aria-label":`${s}, Advertisement, link`,className:l()(e,V),to:i,onClick:r,children:(0,p.jsx)(S.v,{id:"advertiser-info",isInteractive:!1,media:a,padding:"0",subtitle:(0,p.jsx)(T.j,{children:u.Ru.get("ad-formats.advertisement")}),title:(0,p.jsx)(U.d,{children:s})})})};var O=s(41223),F=s(92116);const L="acMBKZuLlROUat0sL2a_",H=({className:e,icon:t,...s})=>(0,p.jsx)("div",{className:l()(L,e),...s,children:t});function z(e){const{imageUrlToExtractHomeAdColorFrom:[,t]}=(0,y.bT)();(0,a.useEffect)((()=>t(e)),[e,t]),(0,a.useEffect)((()=>()=>t(void 0)),[t])}var B=s(72574);function I(e){for(const{imageFileId:t,url:s}of e.display){if(t){const e=(0,B.CCi)(t).toURI();if(e)return e}if(s)return s}}var D=s(84971);const J="lNTmTLY8RhoIIjrz4eyI",W=({className:e,displayAssetUrl:t,homeAd:s})=>{const i=(0,v.L)(),o=(0,P.J)((()=>{i.log("viewed",s)})),r=(0,P.J)((()=>{i.log("clicked",s)}));return(0,a.useEffect)((()=>o()),[o]),(0,p.jsx)(w.N,{to:s.clickthroughUrl,className:e,onClick:r,children:(0,p.jsx)(D._,{className:J,testid:"home-ad-display-asset",loading:"lazy",src:t,children:(0,p.jsx)(H,{icon:(0,p.jsx)(O.b,{})})})})},q=({className:e,homeAd:t})=>{const s=(0,a.useMemo)((()=>I(t)),[t]);return z(s),s?(0,p.jsx)(W,{className:e,homeAd:t,displayAssetUrl:s}):(0,p.jsx)(H,{className:e,icon:(0,p.jsx)(F.c,{size:"large"}),"data-testid":"home-ad-display-asset-fallback"})};var X=s(63857);const $="JS7sJfGVY9xjxR3eWJVq",G=(0,a.memo)((({homeVideoAd:e})=>{const t=(0,a.useMemo)((()=>I(e)),[e]);return t?(0,p.jsx)(W,{className:$,displayAssetUrl:t,homeAd:e}):(0,p.jsx)(H,{className:$,icon:(0,p.jsx)(O.b,{})})}));var Y=s(90496);var Z=s(81129);var Q=s(34668),K=s(34756);const ee=a.useState;var te=s(58910),se=s(80567);class ae{hasLogged=!1;isPlaying=!1;logTimeout=null;position=0;visibilityState="";get trackingEnabled(){return this.focusState.hasFocus()&&this.isPlaying&&this.isAdVisible}constructor(e,t,s,a=new se.j,i){this.focusState=e,this.ad=t,this.logger=s,this.visibilityObserver=a,this.targetElement=i}onPlaybackCreated(e){this.visibilityObserver.observe(this.targetElement,this.onVisibilityChanged),this.focusState.addFocusListener(this),this.position=0,this.reset()}onStarted({position:e}){this.position=e,this.isPlaying=!0,this.startCountdown()}onResumed({position:e}){this.position=e,this.isPlaying=!0,this.startCountdown()}onBuffering({position:e}){this.position=e,this.reset()}onPaused({position:e}){this.isPlaying=!1,this.position=e,this.reset()}onPlaybackEnded({position:e}){this.visibilityObserver.disconnect(),this.focusState.removeFocusListener(this),this.position=e,this.reset()}onFocusChanged(e){this.reset(),e&&this.startCountdown()}startCountdown(){this.hasLogged||(this.clearExistingTimeout(),this.logTimeout=setTimeout((()=>{this.logEvent()}),2e3))}reset(){this.clearExistingTimeout()}clearExistingTimeout(){this.logTimeout&&(clearTimeout(this.logTimeout),this.logTimeout=null)}logEvent(){if(!this.hasLogged&&this.trackingEnabled)try{this.logger.log("viewability",this.ad,{position:Math.floor(1e3*this.position)}),this.hasLogged=!0}catch(e){}}onVisibilityChanged=e=>{const t=this.visibilityState;this.visibilityState=e,"visible_0"!==e&&"visible_unknown"!==e||this.reset();"visible_0"===t&&("visible_50"===e||"visible_100"===e)&&this.startCountdown()};get isAdVisible(){return"visible_50"===this.visibilityState||"visible_100"===this.visibilityState}}var ie=s(46471);var oe=s(555),re=s(15097),ne=s(71695),le=s(83596),de=s(54422),ce=s(64273);const ue="oedSb2mjjyBaeN9twoSA",me="FLXTIzOmNsF6knFRXaZS",he="GJ9evYudn2W7Lr5yMA5i",ye="EjfHeXS7GNvs18SAYXe2",ve=({betamaxPlayer:e,muted:t,paused:s,isContextPlayerVideoPlaying:a,isContextPlayerPlaybackPaused:i})=>{const o=(0,ce.z)();return(0,p.jsxs)("div",{className:ue,children:[(0,p.jsx)("div",{className:he,children:t?(0,p.jsx)(oe.$,{"aria-label":"Unmute, button",colorSet:"overMedia",iconOnly:re.X,onClick:()=>{e.setAudioDisabled(!1),!o.getState()?.item||a||i||o.pause()},size:"small"}):(0,p.jsx)(oe.$,{"aria-label":"Mute, button",colorSet:"overMedia",iconOnly:ne.z,onClick:()=>e.setAudioDisabled(!0),size:"small"})}),(0,p.jsx)("div",{className:ye,children:s?(0,p.jsx)(oe.$,{"aria-label":"Play, button",colorSet:"overMedia",iconOnly:le.A,onClick:()=>{e.resume(),o.getState()?.item&&a&&!i&&o.pause()},size:"medium"}):(0,p.jsx)(oe.$,{"aria-label":"Pause, button",className:me,colorSet:"overMedia",iconOnly:de._,onClick:()=>e.pause(),size:"medium"})})]})};var be=s(62658),fe=s(8433),ge=s(36609);function xe(e,t,s,a){return new be.A({mediaExtensions:[new fe.h(e)],factories:[s]}).createBetamaxPlayer({videoElementConfig:{controls:!1,loop:!0},containerElement:t,networkConfiguration:{getAuthorizationHeader:async()=>{const{accessToken:e,tokenType:t}=await ge.l.get("sp://oauth/v2/token");return`${t} ${e}`}}})}async function pe(e,{mediaUrl:t,playback_id:s,playWhenReady:a}){return await e.play({mediaUrl:t,isRoyaltyMedia:!1,metadata:{playback_id:s}},{playWhenReady:a})}var je=s(60784);const ke="WJllnHWGxXydlZGNRZiO",Pe="r0vbWTxR_IGYTZyvgFMh",Ce=({assetUrl:e,homeVideoAd:t,videoContainerElement:s,createVideoPlayer:i=xe,playVideoPlayer:o=pe})=>{const{betamaxPlayer:r,setBetamaxPlayer:n}=function(){const[e,t]=ee((()=>Promise.resolve(void 0)));return{betamaxPlayer:e,setBetamaxPlayer:t}}(),l=(0,v.L)(),{isContextPlayerVideoPlaying:d,isContextPlayerPlaybackPaused:c}={isContextPlayerVideoPlaying:(0,Q.o)(K.A3),isContextPlayerPlaybackPaused:(0,Q.o)((e=>e?.isPaused))},u=!d||c,{muted:m,paused:h,loading:y,errored:b=!0,observerFactory:f,viewabilityObserverFactory:g}=function(e,t,s,i){const[o,r]=(0,a.useState)(!0),[n,l]=(0,a.useState)(!i),[d,c]=(0,a.useState)(!0),[u,m]=(0,a.useState)(!1),h=(0,a.useCallback)((()=>new ae(new ie.A,e,t,new se.j,s)),[e,t,s]);return{muted:o,paused:n,loading:d,errored:u,observerFactory:(0,a.useCallback)((()=>{let s=0;const a=(e,s)=>{t.log(e,s)},i=(e,t)=>{const i=(e=>{switch(e){case"started":return 1;case"first_quartile":return 2;case"midpoint":return 3;case"third_quartile":return 4;case"ended":case"error":return 5;default:return null}})(e);i?i>s&&(s=i,a(e,t)):a(e,t)};return{onStarted(){i("viewed",e),i("started",e),l(!1)},onResumed(){l((t=>(t&&i("resumed",e),!1)))},onPaused(){l(!0),i("paused",e)},onVolumeChanged({volume:t}){const s=t<=0;r(s),i(s?"muted":"unmuted",e)},onPlaybackCreated({timeObservable:t}){t.addObserverForMediaPositions([.25,.5,.75],(t=>{t>=.25&&i("first_quartile",e),t>=.5&&i("midpoint",e),t>=.75&&i("third_quartile",e)}))},onPlaybackEnded({reason:t}){switch(t){case te.mT.FATAL_ERROR:case te.mT.NETWORK_ERROR:i("error",e);break;case te.mT.PLAYED_TO_END:i("ended",e)}},onReady(){c(!1)},onPlaybackError(){c(!1),m(!0)}}}),[e,t]),viewabilityObserverFactory:h}}(t,l,s,u),x=(0,a.useMemo)((()=>(0,je.U5)((0,je.sH)(t.adId))),[t.adId]),j=function({assetUrl:e,createVideoPlayer:t,playVideoPlayer:s,observerFactory:a,viewabilityObserverFactory:i,playback_id:o,playWhenReady:r,muted:n}){return(0,P.J)((async({videoContainerElement:l,"video-manifest-url":d})=>{try{return await s(t(d,l,a,i).setAudioDisabled(n),{mediaUrl:e,playback_id:o,playWhenReady:r})}catch(e){return}}))}({assetUrl:e,createVideoPlayer:i,playVideoPlayer:o,observerFactory:f,viewabilityObserverFactory:g,playback_id:x,playWhenReady:u,muted:m});return function({videoContainerElement:e,initializeBetamaxPlayer:t,setBetamaxPlayer:s}){const i=(0,Y.g)(),o=(0,a.useRef)(),r=(0,a.useRef)();(0,a.useEffect)((()=>{const a=i.getValues();o.current=a;const n=a.then((s=>{if(a===o.current){const a=s["video-manifest-url"];if(a)return t({videoContainerElement:e,"video-manifest-url":a})}}));r.current=n,s(n),n.then((e=>{n===r.current&&s(e)}))}),[t,e,s,i])}({videoContainerElement:s,initializeBetamaxPlayer:j,setBetamaxPlayer:n}),function({betamaxPlayer:e,assetUrl:t,playVideoPlayer:s,playback_id:i,playWhenReady:o}){const r=(0,P.J)((async t=>{e instanceof Z.M&&await s(e,{mediaUrl:t,playback_id:i,playWhenReady:o})}));(0,a.useEffect)((()=>{r(t)}),[t,r])}({betamaxPlayer:r,assetUrl:e,playVideoPlayer:o,playback_id:x,playWhenReady:u}),((e,t,s=!1)=>{(0,a.useEffect)((()=>{e instanceof Z.M&&!s&&(t?e.pause():e.setAudioDisabled(!0))}),[s,t,e])})(r,d,c),function({betamaxPlayer:e}){(0,a.useEffect)((()=>e&&e instanceof Z.M?()=>{e.release()}:void 0),[e])}({betamaxPlayer:r}),y||r&&"then"in r?(0,p.jsx)(H,{className:$,icon:(0,p.jsx)(X.a3,{"aria-label":"Loading"})}):b||!r?(0,p.jsx)(G,{homeVideoAd:t}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:Pe}),(0,p.jsx)(ve,{betamaxPlayer:r,muted:m,paused:h,isContextPlayerVideoPlaying:d,isContextPlayerPlaybackPaused:c})]})},Ae=({assetUrl:e,className:t,homeVideoAd:s})=>{const[i,o]=(0,a.useState)(null);return z((0,a.useMemo)((()=>s.metadata.logoImage||I(s)),[s])),(0,p.jsx)("div",{"data-testid":"home-ad-video-asset",className:l()(ke,t),ref:o,children:i&&(0,p.jsx)(Ce,{homeVideoAd:s,assetUrl:e,videoContainerElement:i})})};var Ee=s(48354);var Ne=s(98846),we=s(63317);function _e({extractedHomeAdColor:e}){const{extractedHomeAdColor:[,t]}=(0,y.bT)();return(0,a.useEffect)((()=>t(e)),[e,t]),(0,a.useEffect)((()=>()=>t(void 0)),[t]),(0,Ne.z)(e.colorRaw),null}function Re(){const{imageUrlToExtractHomeAdColorFrom:[e]}=(0,y.bT)(),t=(0,we.r)(e);return t?(0,p.jsx)(_e,{extractedHomeAdColor:t}):null}var Se=s(4142);const Te="gPtBODu_UjOYUZsXyVaw",Ue="OMnQ68kGUatqLnLhldea",Ve="qwCxwlFGiJwd7y757EIC",Me="n2TcVzKfe8w5qBzk_mHR",Oe="iBi4L8rZvqCYwumUXiyQ",Fe="BbCl59l9jseBESAVkMFS",Le="_7BNL4Ovo2FE4OHUXD3b",He=(0,Se.H)((({homeAd:e,dismiss:t},s)=>{const i=(0,a.useMemo)((()=>{if(t=e,(0,d.pq)(t.format)===d.nM.VIDEO){const t=function(e){for(const{videoManifestId:t,url:s}of e.video){if(t){const e=Ee.DJ.create(t);if(e)return e}if(s)return s}}(e);if(t)return{homeAd:e,videoAssetUrl:t}}var t}),[e]),{setGridElement:o,shownHeight:n,transitionableStyles:l,containerRef:c,collapseHeightThenDismiss:u}=r({dismiss:t});return(0,p.jsxs)("div",{className:Te,style:l,ref:e=>{c.current=e,"function"==typeof s?s(e):s&&(s.current=e)},"data-testid":"home-ad-card",children:[n&&(0,p.jsx)(Re,{}),(0,p.jsx)("div",{className:Ue,children:(0,p.jsxs)("div",{className:Ve,ref:o,children:[i?(0,p.jsx)(Ae,{className:Me,homeVideoAd:i.homeAd,assetUrl:i.videoAssetUrl}):(0,p.jsx)(q,{className:Me,homeAd:e}),(0,p.jsx)(M,{className:Oe,homeAd:e}),(0,p.jsx)(R,{className:Fe,homeAd:e}),(0,p.jsx)(E,{className:Le,dismiss:u,homeAd:e})]})})]})})),ze=(0,Se.H)((({homeAd:e},t)=>{const{dismissed:s,dismiss:a}=(0,y.bT)();return s?null:(0,p.jsx)(He,{homeAd:e,dismiss:a,ref:t})}))},92448:(e,t,s)=>{s.d(t,{L:()=>i});var a=s(9159);const i=()=>{const{logger:e}=(0,a.bT)();return e}},98846:(e,t,s)=>{s.d(t,{f:()=>n,z:()=>r});var a=s(30758),i=s(668),o=s(7180);function r(e,t=i.l0o){const s=(0,o.as)();return(0,a.useEffect)((()=>(e&&s((0,o.Mo)(e)),()=>{s((0,o.Hf)())})),[e,s]),e||t}const n=({color:e,fallbackColor:t})=>(r(e,t),null)}}]);
//# sourceMappingURL=home-ad-card.js.map