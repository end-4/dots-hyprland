"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[1264,1408],{41793:(e,i,t)=>{t.d(i,{x:()=>C});var n=t(30758),r=t(62411),s=t(13505),a=t(93492),c=t(97500),o=t.n(c),l=t(75773);const d="lyrics-lyricsContent-lyric",u="lyrics-lyricsContent-active",y="lyrics-lyricsContent-highlight",v="lyrics-lyricsContent-unsynced",p="lyrics-lyricsContent-isInteractive",m="lyrics-lyricsContent-text",f="Zg6tXwNaAAopLykLK7Cw",h="lyrics-lyricsContent-provider";var L=t(86070);const g=n.memo((function({onObserve:e,text:i,lineNumber:t,activeLineIndex:r,isTimeSynced:s,translationText:a,onClick:c,onActiveLineChange:h,windowIsVisible:g}){const{ref:b,inView:S}=(0,l.Wx)({threshold:0}),k=(0,n.useRef)(!1);(0,n.useEffect)((()=>{k.current||S&&g&&(e(i),k.current=!0)}),[S,e,i,g]);const w=(0,n.useRef)(),x=(0,n.useRef)(!0);(0,n.useEffect)((()=>{h(w,x.current),x.current=!1}),[r,h]);const I=(0,n.useCallback)((e=>{b(e),w.current=e||void 0}),[b]);return(0,L.jsxs)("div",{dir:"auto",className:o()(d,{[p]:!!c,[u]:r===t,[y]:r>t,[v]:!s}),"data-testid":"fullscreen-lyric",ref:I,onClick:c,children:[(0,L.jsx)("div",{className:m,children:i}),a&&(0,L.jsx)("div",{className:f,children:a})]})}));var b=t(71850);const S={start:0,end:1,text:""};var k=t(9266),w=t(26906),x=t(34668);var I=t(34239),T=t(87975);const C=n.memo((function({trackUri:e,data:i,format:t,onLineClick:c,onActiveLineChange:o,isSnippet:l}){const{provider:d,providerLyricsId:u,providerDisplayName:y,syncType:v,isTimeSynced:p}=i,m=(0,r.d4)(I.s),{lyricWithEmptyLines:f,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}=((e,i,t)=>{const r=(0,n.useRef)(0),{lyrics:s=[],isTimeSynced:a,alternatives:c}=i,o=(0,n.useRef)(0),[l]=(0,b.f)(500,(i=>i?.item?.uri===e)),d=t?c?.find((({language:e})=>e.substring(0,2)===t.substring(0,2)))?.lines:null,u=(0,n.useMemo)((()=>[...new Array(2).fill(S),...s].map(((e,i)=>({...e,lineNumber:i,translationText:d?.[i-2]})))),[s,d]),y=a?u.findIndex((({start:e,end:i})=>l>=e&&l<i)):-1,v=o.current;o.current=y;const p=Math.abs(y-v)<=4,m=Math.abs(l-r.current)>2e3;return r.current=l,{lyricWithEmptyLines:u,activeLineIndex:y,prevActiveLineIndex:v,lineIndexDiff:y-v,shouldAnimateScroll:p,hasSkipped:m}})(e,i,m),A=function(e){const{trackUri:i,format:t,provider:r,providerLyricsId:s,syncType:a,isSnippet:c}=e,[o,l]=(0,n.useState)(!1),[d,u]=(0,n.useState)(0),[y,v]=(0,n.useState)(!1),p=(0,x.o)((e=>e?.playbackId??void 0)),m=(0,n.useMemo)((()=>(0,k.W)({lyrics_format:t,track_uri:i,provider:r,provider_lyrics_id:s,sync_type:a,playback_id:p,is_snippet:c})),[t,i,r,s,a,p,c]);(0,n.useEffect)((()=>{l(!1),u(0),v(!1);const e=setTimeout((()=>{v(!0)}),1500);return()=>{clearTimeout(e)}}),[m]);const f=(0,w.vh)();return(0,n.useEffect)((()=>{o||d>=140&&y&&(f.send(m),l(!0))}),[d,o,m,f,y]),(0,n.useCallback)((e=>{e.length>1&&u((i=>i+e.length))}),[u])}({trackUri:e,format:t,provider:d,providerLyricsId:u,syncType:v,isSnippet:l}),R=(0,T.g)();return(0,L.jsxs)(L.Fragment,{children:[f.map((({text:e,lineNumber:i,translationText:t})=>(0,L.jsx)(g,{text:e,translationText:t,lineNumber:i,activeLineIndex:C,isTimeSynced:p,onObserve:A,onClick:c&&(e=>c(e,f[i].start)),onActiveLineChange:(e,t)=>o({lineRef:e,firstUpdate:t,isFirstLine:p&&0===i,isActiveLine:p&&C===i,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}),windowIsVisible:"visible"===R},i))),!l&&y&&(0,L.jsx)("div",{className:h,children:(0,L.jsx)(s.E,{as:"p",variant:"bodySmall",dir:"auto",children:a.Ru.get("web-player.lyrics.providedBy",y)})})]})}))},18820:(e,i,t)=>{t.d(i,{H:()=>r,k:()=>n});const n=18e5,r=6e5},40292:(e,i,t)=>{t.d(i,{I:()=>h});var n=t(46710),r=t(3118),s=t(18820),a=t(58336),c=t(63524),o=t(58151),l=t(1681),d=t(77343),u=t(8260);function y(e,i,t){const{startTimeMs:n,words:r}=e,s=t[i+1];return{start:n||0,end:s&&s.startTimeMs?s.startTimeMs:1/0,text:r}}function v(e){return d.Q.fromInt(e).toCSS(u.a.RGB)}var p=t(51496),m=t(64640);const f={hasLyrics:!1},h=(e,i)=>{const t=(0,p.h)(i||void 0,{desiredLabel:"large",desiredSize:600})??i?.[0]?.url??"",d=(0,c.X)(),u=(0,r.NC)(m.Tc,{loadingValue:m.LZ.CONTROL}),h={[m.LZ.CONTROL]:void 0,[m.LZ.SYSTEM_LANGUAGE]:navigator.language,[m.LZ.ALL_LANGUAGES]:"all"}[u],L=["lyrics",{uri:e,image:t,vocalRemoval:d}],{hasLyrics:g,isLoading:b}=(0,a.f)(e),{data:S,isLoading:k,isError:w}=(0,n.I)({queryKey:L,queryFn:async()=>{if(!e||!t)return f;const i=await async function(e,i,t=!1,n){try{const a=await(0,o.S)(e,i,t,n);return{hasLyrics:!0,isTimeSynced:(s=a.lyrics.syncType,"LINE_SYNCED"===s||"SYLLABLE_SYNCED"===s),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(y),colors:(r=a.colors,{text:v(r.text),activeText:v(r.highlightText),background:v(r.background)}),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:a.hasVocalRemoval??!1,showUpsell:a.lyrics.showUpsell??!1,alternatives:a.lyrics.alternatives}}catch(e){if(e instanceof l.O&&404===e.status)return{hasLyrics:!1};throw e}var r,s}(e,t,d,h);return i},gcTime:s.k,staleTime:s.H,enabled:g}),x=b||k;let I=null;return x||(I=g?S??null:f),{data:I,loading:x,error:w}}},58336:(e,i,t)=>{t.d(i,{f:()=>d});var n=t(46710),r=t(68813),s=t(3118),a=t(72574),c=t(18820),o=t(58151),l=t(90630);const d=e=>{const i=!!e&&(0,a.U_m)(e),t=(0,s.NC)(l.s6w)&&i,{data:d,isLoading:u}=(0,n.I)({queryKey:["useLyricsAvailability",e],queryFn:async()=>!!e&&await(0,o.z)(e),gcTime:c.k,staleTime:c.H,enabled:t,placeholderData:r.rX});return{isLoading:u,hasLyrics:!!t&&(d??!1)}}},95132:(e,i,t)=>{t.d(i,{J:()=>s});var n=t(40292),r=t(34668);const s=()=>{const e=(0,r.o)((e=>e?.item),((e,i)=>e?.uri===i?.uri));return(0,n.I)(e?.uri,e?.images)}},63524:(e,i,t)=>{t.d(i,{X:()=>a});var n=t(3118),r=t(90630),s=t(15058);const a=()=>{const e=(0,s.S)(),{isSupported:i}=e.getCapabilities();return(0,n.NC)(r.OBX,{loadingValue:!1})&&i}},34239:(e,i,t)=>{t.d(i,{s:()=>r,u:()=>n});const n=e=>e.ui.lyrics.mode,r=e=>e.ui.lyrics.translationLanguage},58151:(e,i,t)=>{t.d(i,{S:()=>a,z:()=>c});var n=t(72574),r=t(49593),s=t(44816);const a=async(e,i,t,a)=>{const c=(0,n.o_h)(e).id,o=r.n.getInstance(),l={format:"json",vocalRemoval:t};a&&(l.clientLanguage=a);return(await o.build().withHost(s.Hj).withPath(`/track/${encodeURIComponent(c)}/image/${encodeURIComponent(i)}`).withQueryParameters(l).withEndpointIdentifier("/track/{trackId}").send()).body},c=async e=>{const i=(0,n.Y8v)((0,n.o_h)(e)?.id);if(!i)return!1;const t=r.n.getInstance(),a=await t.build().withHost(s.XE).withPath(`/track/${encodeURIComponent(i)}`).withEndpointIdentifier("/track/{trackId}").send();return a.body?.has_lyrics||!1}},87975:(e,i,t)=>{t.d(i,{g:()=>r});var n=t(30758);function r(){const[e,i]=(0,n.useState)(document.visibilityState);return(0,n.useEffect)((()=>{const e=()=>i(document.visibilityState);return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}),[]),e}},98846:(e,i,t)=>{t.d(i,{f:()=>c,z:()=>a});var n=t(30758),r=t(668),s=t(7180);function a(e,i=r.l0o){const t=(0,s.as)();return(0,n.useEffect)((()=>(e&&t((0,s.Mo)(e)),()=>{t((0,s.Hf)())})),[e,t]),e||i}const c=({color:e,fallbackColor:i})=>(a(e,i),null)},56882:(e,i,t)=>{t.d(i,{H:()=>a});var n=t(86049),r=t(34668),s=t(51496);function a(){const e=(0,r.o)((e=>e?.item),((e,i)=>e?.uri===i?.uri)),i=(0,s.h)(e?.images||void 0,{desiredLabel:"large",desiredSize:600})??e?.images?.[0]?.url??"",{data:t}=(0,n.g)([i]);return t??null}}}]);
//# sourceMappingURL=1264.js.map